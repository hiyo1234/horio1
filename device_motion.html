<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ジャイロの値を得る</title>
  </head>

  <body>
    <audio id="bgm1">
    <source src="data:audio/wav;base64,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
  F7EoCGNxJxws7MZGJfN2PHq2SUkYrZJTqKBzOIDLHE/1pF6pAexkdZWYf/////K0xnUrqVv8pSxI
  PMYxpc2YPB4WOP/7kgQND/KXM7sHBKACVck3ReCUAEAAAaQAAAAgAAA0gAAABHQBFlDodDpZjFb0
  MZBIPPFJDAo7X/wKxFxRXhXwgrEWCgvArh3+dL/5fCG4mguQ0FSgrsjv64KyGoAADX/////6GNUr
  ylb+pSzGYxn+UrCQDB5xEARZQ6HQ6HWEg8VDVLEg8wkHhZ1KX/5WmM6ldSlKyGDxUMHg8ZREOuUO
  guQVwKfibiC/C9/+dCCngvRSTEFNRTMuOTkuM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
  qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
  qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
  qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
  qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=" type="audio/mp3">
</audio>



    <!-- データを表示するdiv要素 -->
    <button onClick="deviceMotionRequest()">Click</button>
    <button onclick="play_init()" id="play">最初に再生</button><br>
    <!-- <a href="javascript:void(0);" onclick="play_init();">再生</a><br/> -->
    <!-- 加速度データをリアルタイム表示 -->
    <div id="txt">ここにデータを表示</div><br>


    <!-- 加速度の閾値判定 -->
    <div id="acc_status">ここにデータを表示</div><br>
    <h4>正の加速度</h4>
    <meter max="10" low="1" high="4" optimum="0" id="plus">javascriptから参照</meter>
    <h4>負の加速度</h4>
    <meter max="10" low="1" high="4" optimum="0" id="minus">javascriptから参照</meter>

    <script>
      const bgm1 = document.querySelector("#bgm1");
      var all_info = 0;
      var x = 0,
        y = 0,
        z = 0;
      var now_acc_x = 0,
        now_acc_y = 0,
        now_acc_z = 0;
      //var threashold_x = 0, threashold_y = 0, threashold_z = 0;
      var acc_status;

      //音楽の読み込み
      var music = new Audio();

      function deviceMotionRequest() {
        if (navigator.userAgent.match(/iPhone/)) {
          if (DeviceMotionEvent.requestPermission) {
            DeviceMotionEvent.requestPermission().then((permissionState) => {
              if (permissionState === "granted") {
                window.addEventListener("devicemotion", motion);
              }
            });
          }
        } else {
          if (navigator.userAgent.match(/Android.+Mobile/)) {
            window.addEventListener("devicemotion", motion);
          }
        }
      }

      function motion() {

        all_info = event.accelerationIncludingGravity;
        x = all_info.x;
        y = all_info.y;
        z = all_info.z;

      }

      function play_init() {

        //music.src = "tamborine.mp3";
        //music.play();
        bgm1.play();
      
      }

      // 指定時間ごとに繰り返し実行される setInterval(実行する内容, 間隔[ms]) タイマーを設定
      var timer = window.setInterval(() => {
        displayData(); // displayData 関数を実行
      }, 33); // 33msごとに（1秒間に約30回）

      //四捨五入関数
      function orgRound(value, base) {
        return Math.round(value * base) / base;
      }

      // データを表示する displayData 関数
      function displayData() {
        var txt = document.getElementById("txt"); // データを表示するdiv要素の取得

        txt.innerHTML =
          "x方向: " +
          orgRound(x, 10) +
          "<br>" + // x軸の値
          "y方向: " +
          orgRound(y, 10) +
          "<br>" + // y軸の値
          "z方向: " +
          orgRound(z, 10); // z軸の値

          //メータで表示
          if(y >= 0){

            if(y > 4) {
              music.currentTime = 0;
              //music.play();  // 再生
              bgm1.play();
            }
            meter_plus = document.getElementById("plus"); // データを表示するdiv要素の取得
            meter_plus.value = orgRound(y, 10);
            meter_minus = document.getElementById("minus"); // データを表示するdiv要素の取得
            meter_minus.value = 0;

          }
          else{
            if(y < -4) {
              music.currentTime = 0;
              //music.play();  // 再生
              bgm1.play()
            }
            meter_plus = document.getElementById("plus"); // データを表示するdiv要素の取得
            meter_plus.value = 0;
            meter_minus = document.getElementById("minus"); // データを表示するdiv要素の取得
            meter_minus.value = -orgRound(y, 10);

          }

          //閾値処理
          if(y >= -1 && y <= 1){

            acc_status = "status_stop";

          }
          else if(y >= -4 && y < -1){

            acc_status = "status_minuslow";

          }

          else if(y < -4){

            acc_status = "status_minushigh";

          }

          else if(y <= 4 && y > 1){

            acc_status = "status_pluslow";

          }

          else if(y > 4){

            acc_status = "status_plushigh";

          }

          var temp_status = document.getElementById("acc_status"); // データを表示するdiv要素の取得
          temp_status.innerHTML = acc_status;
        
        }

    </script>
  </body>
</html>
